<html>
	<head>
		<meta charset="UTF-8" />
		<title>Online TV - v0.2.roc1100102</title>
		<script>/*Control*/
			function switchFullscreen(){
				if(!document.fullscreenElement){
					document.documentElement.requestFullscreen();
				}else{
					document.exitFullscreen();
				}
			}
		</script>
		<script>/*Notification Manger*/
			notiList = [];
			function createNotifi(id, msg, lastingSecond, styleList){
				if(id!='' && id!=undefined && id!=null && id != "@TEMP" && typeof(notiList[id]) != "undefined"){
					notiList[id].remove();
				}
			
				if(msg!='' && msg!=undefined && msg!=null){
					notifiHolder = document.querySelector("#notifiHolder");
					presetStyleList = {
						"background-color": "rgba(0,0,0,.5)",
						"color": "white",
						"border-radius": "10px",
						"padding": "10px",
						"font-size": "36px",
						"margin": "10px"
					};
					var noti = document.createElement("div");

					noti.innerHTML = msg;
					for(var key in presetStyleList){
						noti.style[key] = presetStyleList[key];
					}
					for(var key in styleList){
						noti.style[key] = styleList[key];
					}
					notifiHolder.appendChild(noti);
					
					if(typeof lastingSecond == "number" && lastingSecond > 0 ){
						window.setTimeout(()=>{noti.remove()}, lastingSecond * 1000);
					}else if(typeof lastingSecond == "string" && lastingSecond == "forever"){
						// do nothing
					}else{
						window.setTimeout(()=>{noti.remove()}, 10000);
					}

					notiList[id] = noti;
					return noti;
				}else{
					return "notiRemoved";
				}

			}
			function cleanAllNotifi(){
				notifiHolder = document.querySelector("#notifiHolder");
				notifiHolder.innerHTML = null;
			}
		</script>
	</head>
	<body style="margin:0; padding: 0">
		<script>document.body.addEventListener("blur", ()=>{console.log("blur!");document.body.focus();});
			setTimeout(()=>{document.body.focus();}, 50);
		</script>
		<div id="playerHolder" style="width: 100vw; height: 100vh; margin: 0; padding: 0">
			<div id="ytPlayer"></div>
			<script>/*Load & auto-play youtube video*/
				// Load the IFrame Player API code asynchronously.
				var tag = document.createElement('script');
				tag.src = "https://www.youtube.com/player_api";
				var firstScriptTag = document.getElementsByTagName('script')[0];
				firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

				// Replace #ytPlayer element with an <iframe> and
				// YouTube ytPlayer after the API code downloads.
				var ytPlayer;
				function onYouTubePlayerAPIReady(){
					ytPlayer = new YT.Player("ytPlayer", {
						height: "100%",
						width: "100%",
						videoId: "9pWXAEZ5NLs",
						playerVars: {
							controls: 0, 
							disablekb: 1, /* disablekb is to remove all the keyboard shortcuts (especially NUMBER). Add back or change some of them later. */
							iv_load_policy:3,
							rel: 0,
							fs: 0
						},
						events:{
							"onReady": (event)=>{
								/*autoplay & try to get up-to-date*/
								ytPlayer.playVideo();
								ytPlayer.toggledEventID = [];
							},
							"onStateChange": (event)=>{
								var state = event.data;
								if(
									state == -1 /*unstarted*/ ||
									state == YT.PlayerState.PAUSED ||
									state == YT.PlayerState.CUED
								){
									var ID = Date.now();
									var a = (event) => {
										if(ytPlayer.toggledEventID.includes(ID)){
											return;
										}
										
										var state = event.data;
										if(
											state == YT.PlayerState.PLAYING ||
											state == YT.PlayerState.BUFFERING
										){
											console.log("state: %d && step 2", state);
											ytPlayer.getUpToDate();
										}
										ytPlayer.toggledEventID.push(ID);
										console.log("a is removed");
										return;
									};
									console.log("state: %d && step 1", state);
									ytPlayer.addEventListener("onStateChange", a);
									console.log("a is created");
									return;
								}
							}
						}
					});/*video control shortcuts*/
					ytPlayer.playAndPause = ()=>{
						if(ytPlayer.getPlayerState() == YT.PlayerState.PAUSED){
							ytPlayer.playVideo();
						}else{
							ytPlayer.pauseVideo();
						}
					};
					ytPlayer.getUpToDate = () => {
						ytPlayer.setPlaybackRate(2);/*Once it gets to the newest, the video would pause for seconds and auto-set the speed to 1*/
						notifi = createNotifi("adjusting", "正在縮短時間差，請稍待……");
					}
					window.addEventListener('keydown', (event)=>{
						switch(event.key){
							case "+":
							case "ArrowUp":
								ytPlayer.setVolume(ytPlayer.getVolume() + 5);
								createNotifi("volume", "Vol:" + ytPlayer.getVolume() + "%", 5);
								break;
							case "-":
							case "ArrowDown":
								ytPlayer.setVolume(ytPlayer.getVolume() - 5);
								createNotifi("volume", "Vol:" + ytPlayer.getVolume() + "%", 5);
								break;
							case " ":
								ytPlayer.playAndPause();
								break;
						}
					});
				}
			</script>
		</div>
		<div id="playerCover" style="width: 100vw; height: 100vh; position: absolute; top: 0; left: 0; padding: 0; margin: 0; opacity: 0">
			<script>
				var playerCover = document.querySelector("#playerCover");
				var playerCoverClicked = (
					()=>{
						var counter = 0;
						var date = new Date;
						var timeout;
						return (event)=>{
							clearTimeout(timeout);
							counter += 1;
							if(counter == 1){
								timeout = setTimeout(()=>{/*play or pause video*/
									ytPlayer.playAndPause();
									counter = 0;
								}, 250);
							}else if(counter >= 2){/*fullscreen*/
								switchFullscreen();
								counter=0;
							}
						}
					}
				)();
				playerCover.addEventListener("click", playerCoverClicked);
			</script>
		</div>
		<div id="notifiHolder" style="width: 100vw; position: absolute; height:0; top: 10vh; left: 0; padding: 0; margin: 0; text-align: center; pointer-events: none">
		</div>
		
	</body>
</html>
